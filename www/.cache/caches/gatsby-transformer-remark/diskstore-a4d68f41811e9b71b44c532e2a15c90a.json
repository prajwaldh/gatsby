{"expireTime":9007200804686334000,"key":"transformer-remark-markdown-html-f540ebe6137965e1418a0fcc06c8fe9a-gatsby-remark-graphvizgatsby-remark-code-titlesgatsby-remark-imagesgatsby-remark-responsive-iframegatsby-remark-autolink-headersgatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypants-","val":"<p>There are two types of plugins that work within Gatsby’s data system, “source”\nand “transformer” plugins.</p>\n<ul>\n<li><strong>Source</strong> plugins “source” data from remote or local locations into what\nGatsby calls <a href=\"/docs/node-interface/\">nodes</a>.</li>\n<li><strong>Transformer</strong> plugins “transform” data provided by source plugins into new\nnodes and/or node fields.</li>\n</ul>\n<p>This doc focuses on source plugins.</p>\n<p>For example:</p>\n<p>The <a href=\"/packages/gatsby-source-filesystem/\"><code class=\"language-text\">gatsby-source-filesystem</code></a> plugin\n“sources” data about files from the file system. It creates nodes with a type\n<code class=\"language-text\">File</code>, each File node corresponding to a file on the filesystem. On each node\nare fields like the <code class=\"language-text\">absolutePath</code>, <code class=\"language-text\">extension</code>, <code class=\"language-text\">modifiedTime</code>, etc.</p>\n<p>And importantly, each node created by the filesystem source plugin includes the\nraw content of the file and its <em>media type</em>.</p>\n<p><a href=\"https://en.wikipedia.org/wiki/Media_type\">A <strong>media type</strong></a> (also <strong>MIME type</strong>\nand <strong>content type</strong>) are an official way to identify the format of\nfiles/content that is transmitted on the internet e.g. over HTTP or through\nemail. You’re probably familiar with many media types such as\n<code class=\"language-text\">application/javascript</code>, <code class=\"language-text\">application/pdf</code>, <code class=\"language-text\">audio/mpeg</code>, <code class=\"language-text\">text/html</code>,\n<code class=\"language-text\">text/plain</code>, <code class=\"language-text\">image/jpeg</code>, etc.</p>\n<p>Each source plugin is responsible for setting the media type for the nodes they\ncreate. This way, source and transformer plugins can work together easily.</p>\n<p>This is not a required field but it’s the way for source plugins to indicate to\ntransformers that there is “raw” data that can still be further processed. It\nallows plugins to remain small and focused. Source plugins don’t have to have\nopinions on how to transform their data. They can just set the <code class=\"language-text\">mediaType</code> and\npush that responsibility to transformer plugins.</p>\n<p>For example, it’s quite common for services to allow you to add content as\nmarkdown. If you pull that markdown into Gatsby and create a new node, what\nthen? How would a user of your source plugin convert that markdown into HTML\nthey can use in their site? Luckily you don’t have to do anything. Just create a\nnode for the markdown content and set its mediaType as <code class=\"language-text\">text/markdown</code> and the\nvarious Gatsby markdown transformer plugins will see your node and transform it\ninto HTML.</p>\n<p>This loose coupling between the data source and the transformer plugins allow Gatsby\nsite builders to quickly assemble complex data transformation pipelines with\nlittle work on their (and your (the source plugin author)) part.</p>\n<p>What does the code look like?</p>\n<p>A source plugin is a normal NPM package. It has a package.json with optional\ndependencies as well as a <code class=\"language-text\">gatsby-node.js</code> where you implement Gatsby’s Node.js\nAPIs. Gatsby’s minimum supported Node.js version is Node 8 and as it’s common to want to\nuse more modern Node.js and JavaScript syntax, many plugins write code in a\nsource directory and compile the code. All plugins maintained in the Gatsby repo\nfollow this pattern.</p>\n<p>Your <code class=\"language-text\">gatsby-node.js</code> should look something like:</p>\n<div class=\"gatsby-code-title\">gatsby-node.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">exports<span class=\"token punctuation\">.</span>sourceNodes <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> actions <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createNode <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> actions\n  <span class=\"token comment\">// Create nodes here, generally by downloading data</span>\n  <span class=\"token comment\">// from a remote API.</span>\n  <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token constant\">REMOTE_API</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// Process data into nodes.</span>\n  data<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>datum <span class=\"token operator\">=></span> <span class=\"token function\">createNode</span><span class=\"token punctuation\">(</span><span class=\"token function\">processDatum</span><span class=\"token punctuation\">(</span>datum<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// We're done, return.</span>\n  <span class=\"token keyword\">return</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Peruse the <a href=\"/docs/node-apis/#sourceNodes\"><code class=\"language-text\">sourceNodes</code></a> and\n<a href=\"/docs/bound-action-creators/#createNode\"><code class=\"language-text\">createNode</code></a> docs for detailed\ndocumentation on implementing those APIs.</p>\n<p>But at a high-level, these are the jobs of a source plugin:</p>\n<ul>\n<li>Ensure local data is synced with its source and 100% accurate. If your source\nallows you to add an <code class=\"language-text\">updatedSince</code> query (or something similar) you can store\nthe last time you fetched data using\n<a href=\"/docs/bound-action-creators/#setPluginStatus\"><code class=\"language-text\">setPluginStatus</code></a>.</li>\n<li>Create nodes with accurate media types, human meaningful types, and accurate\ncontentDigests.</li>\n<li>“Link” nodes types you create as appropriate (see\n<a href=\"/docs/api-specification/\"><em>Node Link</em></a> in the API specification concepts\nsection.</li>\n<li>Return either a promise or use the callback (3rd parameter) to report back to Gatsby when <code class=\"language-text\">sourceNodes</code> is fully executed. If a promise or callback isn’t returned, Gatsby will continue on in the build process, before nodes are finished being created. Your nodes might not end up in the generated schema at compilation, or the process will hang while waiting for an indication that it’s finished.</li>\n</ul>\n<p><a href=\"https://github.com/angeloashmore/gatsby-node-helpers\"><code class=\"language-text\">gatsby-node-helpers</code></a>,\na community-made NPM package, can help when writing source plugins. This\npackage provides a set of helper functions to generate Node objects with the\nrequired fields. This includes automatically generating fields like node IDs\nand the <code class=\"language-text\">contentDigest</code> MD5 hash, keeping your code focused on data gathering,\nnot boilerplate.</p>\n<h2 id=\"advanced\"><a href=\"#advanced\" aria-label=\"advanced permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Advanced</h2>\n<h3 id=\"adding-relationships-between-nodes\"><a href=\"#adding-relationships-between-nodes\" aria-label=\"adding relationships between nodes permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Adding relationships between nodes</h3>\n<p>Gatsby source plugins not only create nodes, they also create relationships between nodes that are exposed to GraphQL queries.</p>\n<p>There are two ways of adding node relationships in Gatsby: (1) transformations (parent-child) or (2) foreign-key based.</p>\n<h4 id=\"transformation-relationships\"><a href=\"#transformation-relationships\" aria-label=\"transformation relationships permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Transformation relationships</h4>\n<p>An example of a transformation relationship is the <code class=\"language-text\">gatsby-transformer-remark</code> plugin, which transforms a parent <code class=\"language-text\">fileNode</code>’s markdown string into a <code class=\"language-text\">MarkdownRemark</code> node. The Remark transformer plugin adds its newly created child node as a child of the parent node using the action <code class=\"language-text\">createParentChildLink</code>. Transformation relationships are used when a new node is <em>completely</em> derived from a single parent node. E.g. the markdown node is derived from the parent <code class=\"language-text\">fileNode</code> and wouldn’t ever exist if the parent <code class=\"language-text\">fileNode</code> hadn’t been created.</p>\n<p>Because all children nodes are derived from their parent, when a parent node is deleted or changed, Gatsby deletes all of the child nodes (and their child nodes, and so on) with the expectation that they’ll be recreated again by transformer plugins. This is done to ensure there are no nodes left over that were derived from older versions of data but shouldn’t exist any longer.</p>\n<p><em>Creating the transformation relationship</em></p>\n<p>In order to create a parent/child relationship, when calling <code class=\"language-text\">createNode</code> for the child node, the new node object that is passed in should have a <code class=\"language-text\">parent</code> key with the value set to the parent node’s <code class=\"language-text\">id</code>. After this, call the <code class=\"language-text\">createParentChildLink</code> function exported inside <code class=\"language-text\">actions</code>.</p>\n<p><em>Examples</em></p>\n<p><a href=\"https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby-transformer-remark/src/on-node-create.js#L34-L64\">Here’s the above example</a> from the <code class=\"language-text\">gatsby-transformer-remark</code> source plugin.</p>\n<p><a href=\"https://github.com/gatsbyjs/gatsby/blob/1fb19f9ad16618acdac7eda33d295d8ceba7f393/packages/gatsby-transformer-sharp/src/on-node-create.js#L3-L25\">Here’s another example</a> from the <code class=\"language-text\">gatsby-transformer-sharp</code> source plugin.</p>\n<h4 id=\"foreign-key-relationships\"><a href=\"#foreign-key-relationships\" aria-label=\"foreign key relationships permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Foreign-key relationships</h4>\n<p>An example of a foreign-key relationship would be a Post that has an Author.</p>\n<p>In this relationship, each object is a distinct entity that exists whether or not the other does, with independent schemas, and field(s) on each entity that reference the other entity — in this case the Post would have an Author, and the Author might have Posts. The API of a service that allows complex object modelling, for example a CMS, will often allow users to add relationships between entities and expose them through the API.</p>\n<p>When an object node is deleted, Gatsby <em>does not</em> delete any referenced entities. When using foreign-key references, it’s a source plugin’s responsibility to clean up any dangling entity references.</p>\n<h5 id=\"creating-the-relationship\"><a href=\"#creating-the-relationship\" aria-label=\"creating the relationship permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Creating the relationship</h5>\n<p>Let’s say you want to create a relationship between Posts and Authors, and let’s say you want to call the field <code class=\"language-text\">author</code>.</p>\n<p>Before you pass the Post object and Author object into <code class=\"language-text\">createNode</code> and create the respective nodes, you need to create a field called <code class=\"language-text\">author___NODE</code> on the Post object to hold the relationship to Authors. The value of this field should be the node ID of the Author.</p>\n<h5 id=\"creating-the-reverse-relationship\"><a href=\"#creating-the-reverse-relationship\" aria-label=\"creating the reverse relationship permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Creating the reverse relationship</h5>\n<p>It’s often convenient for querying to add to the schema backwards references. For example, you might want to query the Author of a Post but you might also want to query all the posts an author has written.</p>\n<p>If you want to call this field on <code class=\"language-text\">Author</code> <code class=\"language-text\">posts</code>, you would create a field called <code class=\"language-text\">posts___NODE</code> to hold the relationship to Posts. The value of this field should be an array of Post IDs.</p>\n<p>Here’s an example from the <a href=\"https://github.com/gatsbyjs/gatsby/blob/1fb19f9ad16618acdac7eda33d295d8ceba7f393/packages/gatsby-source-wordpress/src/normalize.js#L178-L189\">WordPress source plugin</a>.</p>\n<h4 id=\"union-types\"><a href=\"#union-types\" aria-label=\"union types permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Union types</h4>\n<p>When creating fields linking to an array of nodes, if the array of IDs are all of the same type, the relationship field that is created will be of this type. If the linked nodes are of different types; the field will turn into a union type of all types that are linked. See the <a href=\"https://graphql.org/learn/schema/#union-types\">GraphQL documentation on how to query union types</a>.</p>"}