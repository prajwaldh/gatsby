{"expireTime":9007200804686247000,"key":"transformer-remark-markdown-html-728af339c2b12233b1bd02ec86075911-gatsby-remark-graphvizgatsby-remark-code-titlesgatsby-remark-imagesgatsby-remark-responsive-iframegatsby-remark-autolink-headersgatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypants-","val":"<h1 id=\"gatsby-source-mailchimp\"><a href=\"#gatsby-source-mailchimp\" aria-label=\"gatsby source mailchimp permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>gatsby-source-mailchimp</h1>\n<p>Use your <a href=\"https://developer.mailchimp.com\">Mailchimp API</a> key to download your campaigns into <a href=\"https://www.gatsbyjs.org/\">Gatsby</a>’s GraphQL data layer!</p>\n<p>⚠ <strong>Please note:</strong> This plugin was made out of a specific necessity, so it doesn’t cover all of Mailchimp’s data sources, focusing only on campaigns. If you want to add extra functionalities, feel free to <a href=\"https://github.com/hcavalieri/gatsby-source-mailchimp/pulls\">create a PR</a> and contribute :smile:</p>\n<h2 id=\"table-of-content\"><a href=\"#table-of-content\" aria-label=\"table of content permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Table of content</h2>\n<ul>\n<li><a href=\"#basic-usage\">Basic Usage</a></li>\n<li><a href=\"#options\">Options</a></li>\n<li><a href=\"#caveats\">Caveats</a></li>\n<li><a href=\"#todo\">Todo</a></li>\n<li><a href=\"#license\">License</a></li>\n</ul>\n<h2 id=\"basic-usage\"><a href=\"#basic-usage\" aria-label=\"basic usage permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Basic usage</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">yarn add gatsby-source-mailchimp\n# or\nnpm i gatsby-source-mailchimp --save</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// in your gatsby-config.js</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      resolve<span class=\"token punctuation\">:</span> <span class=\"token string\">'gatsby-source-mailchimp'</span><span class=\"token punctuation\">,</span>\n      options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Avoid including your key directly in your file.</span>\n        <span class=\"token comment\">// Instead, opt for adding them to .env files for extra</span>\n        <span class=\"token comment\">// security ;)</span>\n        key<span class=\"token punctuation\">:</span> <span class=\"token string\">'asd712jdas90122jdas90122jkadsd1-usXX'</span><span class=\"token punctuation\">,</span>\n        rootURL<span class=\"token punctuation\">:</span> <span class=\"token string\">'https://usXX.api.mailchimp.com/3.0'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Go through <a href=\"http://localhost:8000/___graphql\">http://localhost:8000/___graphql</a> after running <code class=\"language-text\">gatsby develop</code> to understand the created data and create a new query and checking available collections and fields by typing <code class=\"language-text\">CTRL + SPACE</code>.</p>\n<h2 id=\"options\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<table>\n<thead>\n<tr>\n<th>Options</th>\n<th>Type</th>\n<th>Default</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>key</td>\n<td>string</td>\n<td></td>\n<td><strong>[required]</strong> Your API key</td>\n</tr>\n<tr>\n<td>rootURL</td>\n<td>string</td>\n<td></td>\n<td><strong>[required]</strong> Your key’s root API URL. Usually in the format <code class=\"language-text\">https://usXX.api.mailchimp.com/3.0</code></td>\n</tr>\n<tr>\n<td>authUsername</td>\n<td>string</td>\n<td><code class=\"language-text\">GatsbyChimp</code></td>\n<td>In case you want to name your requests, fill this value.</td>\n</tr>\n<tr>\n<td>campaignFields</td>\n<td>array of strings</td>\n<td>See the <a href=\"#default-campaignFields-value\">section below</a></td>\n<td>Which fields to fetch from campaigns’ metadata. See <a href=\"https://developer.mailchimp.com/documentation/mailchimp/reference/campaigns\">Mailchimp’s documentation on campaigns fields</a></td>\n</tr>\n<tr>\n<td>contentFields</td>\n<td>array of strings</td>\n<td><code class=\"language-text\">[&#39;html&#39;]</code></td>\n<td>Which fields to fetch from campaigns’ content. See <a href=\"https://developer.mailchimp.com/documentation/mailchimp/reference/campaigns/content/\">Mailchimp’s documentation on campaign content fields</a></td>\n</tr>\n<tr>\n<td>nodeType</td>\n<td>string</td>\n<td><code class=\"language-text\">MailchimpCampaign</code></td>\n<td>How to name campaign nodes in GraphQL</td>\n</tr>\n<tr>\n<td>count</td>\n<td>string</td>\n<td><code class=\"language-text\">30</code></td>\n<td>Number of campaigns to fetch. <strong>Use <code class=\"language-text\">0</code> in order to fetch them all</strong></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"default-campaignfields-value\"><a href=\"#default-campaignfields-value\" aria-label=\"default campaignfields value permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Default <code class=\"language-text\">campaignFields</code> value</h3>\n<p>In terms of metadata, I believe most users will only need the campaign’s <code class=\"language-text\">type</code> and <code class=\"language-text\">status</code> for filtering; <code class=\"language-text\">title</code> for internal usage; <code class=\"language-text\">send_time</code> for displaying dates for users; and <code class=\"language-text\">subject_line</code> and <code class=\"language-text\">preview_text</code> for showing a preview of the campaign. For such, the default fields are as follow:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> defaultCampaignsFields <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token string\">'campaigns.type'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'campaigns.status'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'campaigns.send_time'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'campaigns.settings.subject_line'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'campaigns.settings.preview_text'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'campaigns.settings.title'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>You can refer to <a href=\"https://developer.mailchimp.com/documentation/mailchimp/reference/campaigns\">Mailchimp’s documentation on campaigns</a> in order to explore what other fields you can fetch, but be aware that you’ll have to include these in your custom <code class=\"language-text\">campaignFields</code> if you want them to show up in results!</p>\n<h2 id=\"using-env-variables-to-hide-your-key\"><a href=\"#using-env-variables-to-hide-your-key\" aria-label=\"using env variables to hide your key permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Using .env variables to hide your key</h2>\n<p>If you don’t want to attach your API key to the repo, you can easily store it in .env files by doing the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// In your .env file</span>\n<span class=\"token constant\">MAILCHIMP_KEY</span> <span class=\"token operator\">=</span> <span class=\"token string\">'asd712jdas90122jdas90122jkadsd1-usXX'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// In your gatsby-config.js file</span>\n<span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dotenv'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  path<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`.env.</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      resolve<span class=\"token punctuation\">:</span> <span class=\"token string\">'gatsby-source-mailchimp'</span><span class=\"token punctuation\">,</span>\n      options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        key<span class=\"token punctuation\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">MAILCHIMP_KEY</span><span class=\"token punctuation\">,</span>\n        rootURL<span class=\"token punctuation\">:</span> <span class=\"token string\">'https://usXX.api.mailchimp.com/3.0'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// ...</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This example is based off <a href=\"https://next.gatsbyjs.org/docs/environment-variables\">Gatsby Docs’ implementation</a>.</p>\n<h2 id=\"caveats\"><a href=\"#caveats\" aria-label=\"caveats permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Caveats</h2>\n<p>As of now, the only known caveat is that, in order to preserve cache and avoid fetching the HTML content for each campaign every single time (which takes from 20s to 1m for 50 large campaigns), the plugin uses Gatsby’s cache in a way that <strong>considers changes made only to the <code class=\"language-text\">campaignFields</code></strong>. If you make a minor change to your HTML, as it stands, you’ll have to change some of the campaign metadata that you’re pulling into your site.</p>\n<p>Unfortunately, Mailchimp doesn’t offer a <code class=\"language-text\">last_edited</code> field, so all we can do for now is to avoid caching alltogether. I haven’t added a flag for this because it seems quite unnecessary, but feel free to create an optional <code class=\"language-text\">avoidCaching</code> param if you need!</p>\n<h2 id=\"reference\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h2>\n<p>The process to save campaigns in <code class=\"language-text\">gatsby-node.js</code> is as follows:</p>\n<ol>\n<li>We hit the <code class=\"language-text\">/campaigns/</code> endpoint with due limits and pagination (set by user configuration);</li>\n<li>This returns each campaign’s metadata, which is used to check the cache.</li>\n<li>If it’s in cache, then we’re good, else we add a request to its content to an array;</li>\n<li>We run <code class=\"language-text\">Promise.all</code> with this array and iterate over it to get each campaign’s content;</li>\n<li>Finally, we join the metadata and content and create the node, setting a new entry to the cache :wink:.</li>\n</ol>\n<h2 id=\"todo\"><a href=\"#todo\" aria-label=\"todo permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TODO</h2>\n<ul>\n<li>Explore better ways to cache the content.</li>\n<li>Concurrent requests in a way that respects Mailchimp’s 10 requests/minute limitation</li>\n</ul>\n<h2 id=\"license\"><a href=\"#license\" aria-label=\"license permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>License</h2>\n<p>I’m not very literate on licensing, so I just went with <strong>MIT</strong>, if you have any considerations just let me know! Oh, and, of course, feel free to contribute to this plugin, even bug reports are welcome!</p>"}