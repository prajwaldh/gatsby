{"expireTime":9007200804686348000,"key":"transformer-remark-markdown-html-8854f933399ea7f7c1fdf43bac37fc25-gatsby-remark-graphvizgatsby-remark-code-titlesgatsby-remark-imagesgatsby-remark-responsive-iframegatsby-remark-autolink-headersgatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypants-","val":"<p>Popular CSS-in-JS libraries like <a href=\"https://github.com/styled-components/styled-components\">styled-components</a> or <a href=\"https://github.com/emotion-js/emotion\">emotion</a> can also be tested with the help of <a href=\"https://github.com/styled-components/jest-styled-components\">jest-styled-components</a> or <a href=\"https://github.com/emotion-js/emotion/tree/master/packages/jest-emotion\">jest-emotion</a> respectively. These packages improve Jest’s built-in snapshot testing experience and are a great way to help avoid unintended changes to your website’s UI. Please refer to your package’s documentation to see if it also offers testing capabilities.</p>\n<p><em>Snapshot serializers</em> like <code class=\"language-text\">jest-styled-components</code> or <code class=\"language-text\">jest-emotion</code> modify the standard output to a more meaningful and readable snapshot, e.g. by removing unnecessary information or displaying data in another format. Which ultimately leads to more comparable and effective snapshot tests.</p>\n<p>By default snapshots of your styled components show the generated class names (which you didn’t set) and no styling information. When changing the styles you’ll only see the diff of some cryptic class names (hashes). That’s why you should use the above mentioned <em>snapshot serializers</em>. They remove the hashes and format the CSS in style elements.</p>\n<p>For this example we’ll use emotion. The testing utilities of emotion and glamor are largely based on <a href=\"https://github.com/styled-components/jest-styled-components\">jest-styled-components</a> so they have a similar usage. Please have a look at the testing section of your library to follow along.</p>\n<h2 id=\"installation\"><a href=\"#installation\" aria-label=\"installation permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installation</h2>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev jest-emotion babel-plugin-emotion</code></pre></div>\n<p>As <a href=\"https://www.gatsbyjs.org/packages/gatsby-plugin-emotion/\">Gatsby’s emotion plugin</a> is using <code class=\"language-text\">babel-plugin-emotion</code> under the hood you’ll also need to install it so that Jest can use it.</p>\n<p>If you followed along with the <a href=\"/docs/unit-testing\">Unit testing guide</a> you’ll have the file <code class=\"language-text\">jest-preprocess.js</code> at the root of your project. Open that file and add the plugin:</p>\n<div class=\"gatsby-code-title\">jest-preprocess.js</div>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\">const babelOptions = {\n  presets: [\"babel-preset-gatsby\"],\n<span class=\"token inserted\">+  plugins: [</span>\n<span class=\"token inserted\">+    \"emotion\",</span>\n<span class=\"token inserted\">+  ],</span>\n}\n\nmodule.exports = require(\"babel-jest\").createTransformer(babelOptions)</code></pre></div>\n<p>In order to tell Jest to use the serializer you’ll need to create the file <code class=\"language-text\">setup-test-env.js</code> which will be run automatically before every test. Create the file <code class=\"language-text\">setup-test-env.js</code> at the root of your project. Insert this code into it:</p>\n<div class=\"gatsby-code-title\">setup-test-env.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createSerializer <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"jest-emotion\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> emotion <span class=\"token keyword\">from</span> <span class=\"token string\">\"emotion\"</span>\n\nexpect<span class=\"token punctuation\">.</span><span class=\"token function\">addSnapshotSerializer</span><span class=\"token punctuation\">(</span><span class=\"token function\">createSerializer</span><span class=\"token punctuation\">(</span>emotion<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Lastly you need to tell Jest where to find this file. Open your <code class=\"language-text\">package.json</code> and add this entry to your <code class=\"language-text\">&quot;jest&quot;</code> section:</p>\n<div class=\"gatsby-code-title\">package.json</div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"jest\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"setupTestFrameworkScriptFile\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;rootDir>/setup-test-env.js\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"usage\"><a href=\"#usage\" aria-label=\"usage permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Usage</h2>\n<p>In this example you’ll use <code class=\"language-text\">react-test-renderer</code> but you can also use <a href=\"/docs/testing-react-components\">react-testing-library</a> or any other appropriate library. Because you created the <code class=\"language-text\">setup-test-env.js</code> file you can write your unit tests like you used to do. But now you’ll also get the styling information!</p>\n<div class=\"gatsby-code-title\">src/components/Button.test.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"token keyword\">import</span> styled <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-emotion\"</span>\n<span class=\"token keyword\">import</span> renderer <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-test-renderer\"</span>\n\n<span class=\"token keyword\">const</span> Button <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>div<span class=\"token template-string\"><span class=\"token string\">`\n  color: hotpink;\n`</span></span>\n\n<span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Button renders correctly\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>\n    renderer<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>Button<span class=\"token operator\">></span>This is hotpink<span class=\"token punctuation\">.</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Button<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>The resulting snapshot will look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Jest Snapshot v1, https://goo.gl/fbAQLP</span>\n\nexports<span class=\"token punctuation\">[</span><span class=\"token template-string\"><span class=\"token string\">`Button renders correctly 1`</span></span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`\n.emotion-0 {\n  color: hotpink;\n}\n\n&lt;div\n  className=\"emotion-0 emotion-1\"\n>\n  This is hotpink.\n&lt;/div>\n`</span></span></code></pre></div>\n<p>If your styled component depends on <code class=\"language-text\">theme</code> via <code class=\"language-text\">ThemeProvider</code> you’ll have two options:</p>\n<ul>\n<li>Wrap all your components with the <code class=\"language-text\">ThemeProvider</code></li>\n<li>Use API helpers (have a look at the library’s documentation, e.g. <a href=\"https://github.com/styled-components/jest-styled-components#theming\">styled-components</a> or <a href=\"https://github.com/emotion-js/emotion/tree/master/packages/emotion-theming#createbroadcast-function\">emotion</a>)</li>\n</ul>\n<p>And this is where snapshots tests really shine. If you change, e.g. the primary color in your theme file you’ll see which components get affected by this change. This way you can catch unintended changes to the style of your components.</p>\n<p>This example uses the first option:</p>\n<div class=\"gatsby-code-title\">src/components/Wrapper.test.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ThemeProvider <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"emotion-theming\"</span>\n<span class=\"token keyword\">import</span> renderer <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-test-renderer\"</span>\n\n<span class=\"token keyword\">const</span> theme <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  maxWidth<span class=\"token punctuation\">:</span> <span class=\"token string\">\"1450px\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> Wrapper <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>section<span class=\"token template-string\"><span class=\"token string\">`\n  max-width: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>props <span class=\"token operator\">=></span> props<span class=\"token punctuation\">.</span>theme<span class=\"token punctuation\">.</span>maxWidth<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">;\n`</span></span>\n\n<span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Wrapper renders correctly\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>\n    renderer\n      <span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>\n        <span class=\"token operator\">&lt;</span>ThemeProvider theme<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>theme<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>Wrapper<span class=\"token operator\">></span>Content<span class=\"token punctuation\">.</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Wrapper<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ThemeProvider<span class=\"token operator\">></span>\n      <span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">toJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>The resulting snapshot will look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Jest Snapshot v1, https://goo.gl/fbAQLP</span>\n\nexports<span class=\"token punctuation\">[</span><span class=\"token template-string\"><span class=\"token string\">`Wrapper renders correctly 1`</span></span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`\n.emotion-0 {\n  max-width: 1450px;\n}\n\n&lt;section\n  className=\"emotion-0 emotion-1\"\n>\n  Content\n&lt;/div>\n`</span></span></code></pre></div>"}