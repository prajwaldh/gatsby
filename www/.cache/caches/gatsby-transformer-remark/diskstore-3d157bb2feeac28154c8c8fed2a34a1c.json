{"expireTime":9007200804686345000,"key":"transformer-remark-markdown-html-f8e6cf408fd76184ba6ef212cfe36248-gatsby-remark-graphvizgatsby-remark-code-titlesgatsby-remark-imagesgatsby-remark-responsive-iframegatsby-remark-autolink-headersgatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypants-","val":"<h3 id=\"query-execution\"><a href=\"#query-execution\" aria-label=\"query execution permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Query Execution</h3>\n<p>Query Execution is kicked off by bootstrap by calling <a href=\"https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby/src/internal-plugins/query-runner/page-query-runner.js#L29\">page-query-runner.js runInitialQuerys()</a>. The main files involved in this step are:</p>\n<ul>\n<li><a href=\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby/src/internal-plugins/query-runner/query-queue.js\">page-query-runner.js</a></li>\n<li><a href=\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby/src/internal-plugins/query-runner/query-queue.js\">query-queue.js</a></li>\n<li><a href=\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby/src/internal-plugins/query-runner/query-runner.js\">query-runner.js</a></li>\n</ul>\n<p>Hereâ€™s an overview of how it all relates:</p>\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\"\n \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<!-- Generated by graphviz version 2.40.1 (20161225.0304)\n -->\n<!-- Title: %0 Pages: 1 -->\n<svg width=\"632pt\" height=\"645pt\"\n viewBox=\"0.00 0.00 632.00 644.80\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n<g id=\"graph0\" class=\"graph\" transform=\"scale(1 1) rotate(0) translate(4 640.8)\">\n<title>%0</title>\n<polygon fill=\"#ffffff\" stroke=\"transparent\" points=\"-4,4 -4,-640.8 628,-640.8 628,4 -4,4\"/>\n<g id=\"clust1\" class=\"cluster\">\n<title>cluster_other</title>\n</g>\n<g id=\"clust2\" class=\"cluster\">\n<title>cluster_pageQueryRunner</title>\n<polygon fill=\"none\" stroke=\"#000000\" points=\"8,-326.8 8,-547.6 564,-547.6 564,-326.8 8,-326.8\"/>\n<text text-anchor=\"middle\" x=\"286\" y=\"-531\" font-family=\"Times,serif\" font-size=\"14.00\" fill=\"#000000\">page&#45;query&#45;runner.js</text>\n</g>\n<g id=\"clust3\" class=\"cluster\">\n<title>cluster_queryQueue</title>\n<polygon fill=\"none\" stroke=\"#000000\" points=\"259,-242 259,-318.8 361,-318.8 361,-242 259,-242\"/>\n<text text-anchor=\"middle\" x=\"310\" y=\"-302.2\" font-family=\"Times,serif\" font-size=\"14.00\" fill=\"#000000\">query&#45;queue.js</text>\n</g>\n<g id=\"clust4\" class=\"cluster\">\n<title>cluster_queryRunner</title>\n<polygon fill=\"none\" stroke=\"#000000\" points=\"146,-85.2 146,-234 474,-234 474,-85.2 146,-85.2\"/>\n<text text-anchor=\"middle\" x=\"310\" y=\"-217.4\" font-family=\"Times,serif\" font-size=\"14.00\" fill=\"#000000\">query&#45;runner.js</text>\n</g>\n<!-- extractQueries -->\n<g id=\"node1\" class=\"node\">\n<title>extractQueries</title>\n<polygon fill=\"none\" stroke=\"#000000\" points=\"133.6731,-610.2 24.3269,-610.2 24.3269,-574.2 133.6731,-574.2 133.6731,-610.2\"/>\n<text text-anchor=\"middle\" x=\"79\" y=\"-588\" font-family=\"Times,serif\" font-size=\"14.00\" fill=\"#000000\">query&#45;watcher.js</text>\n</g>\n<!-- extractedQueryQ -->\n<g id=\"node6\" class=\"node\">\n<title>extractedQueryQ</title>\n<polygon fill=\"none\" stroke=\"#000000\" points=\"184.3834,-442.8 15.6166,-442.8 15.6166,-406.8 184.3834,-406.8 184.3834,-442.8\"/>\n<text text-anchor=\"middle\" x=\"100\" y=\"-420.6\" font-family=\"Times,serif\" font-size=\"14.00\" fill=\"#000000\">queueQueryForPathname()</text>\n</g>\n<!-- extractQueries&#45;&gt;extractedQueryQ -->\n<g id=\"edge8\" class=\"edge\">\n<title>extractQueries&#45;&gt;extractedQueryQ</title>\n<path fill=\"none\" stroke=\"#000000\" d=\"M81.2873,-573.9666C84.9324,-544.9104 92.088,-487.8699 96.4172,-453.3598\"/>\n<polygon fill=\"#000000\" stroke=\"#000000\" points=\"99.9434,-453.3688 97.7155,-443.0109 92.9979,-452.4975 99.9434,-453.3688\"/>\n</g>\n<!-- componentsDD -->\n<g id=\"node2\" class=\"node\">\n<title>componentsDD</title>\n<path fill=\"none\" stroke=\"#000000\" d=\"M334.6517,-615.6821C334.6517,-618.5614 293.5719,-620.9004 243,-620.9004 192.4281,-620.9004 151.3483,-618.5614 151.3483,-615.6821 151.3483,-615.6821 151.3483,-568.7179 151.3483,-568.7179 151.3483,-565.8386 192.4281,-563.4996 243,-563.4996 293.5719,-563.4996 334.6517,-565.8386 334.6517,-568.7179 334.6517,-568.7179 334.6517,-615.6821 334.6517,-615.6821\"/>\n<path fill=\"none\" stroke=\"#000000\" d=\"M334.6517,-615.6821C334.6517,-612.8028 293.5719,-610.4639 243,-610.4639 192.4281,-610.4639 151.3483,-612.8028 151.3483,-615.6821\"/>\n<text text-anchor=\"start\" x=\"159.4242\" y=\"-596.4\" font-family=\"Times,serif\" font-size=\"14.00\" fill=\"#000000\">componentDataDependencies</text>\n<text text-anchor=\"middle\" x=\"243\" y=\"-579.6\" font-family=\"Times,serif\" font-size=\"14.00\" fill=\"#000000\">(redux)</text>\n</g>\n<!-- findIdsWithoutDD -->\n<g id=\"node7\" class=\"node\">\n<title>findIdsWithoutDD</title>\n<polygon fill=\"none\" stroke=\"#000000\" points=\"417.8053,-442.8 202.1947,-442.8 202.1947,-406.8 417.8053,-406.8 417.8053,-442.8\"/>\n<text text-anchor=\"middle\" x=\"310\" y=\"-420.6\" font-family=\"Times,serif\" font-size=\"14.00\" fill=\"#000000\">findIdsWithoutDataDependencies()</text>\n</g>\n<!-- componentsDD&#45;&gt;findIdsWithoutDD -->\n<g id=\"edge9\" class=\"edge\">\n<title>componentsDD&#45;&gt;findIdsWithoutDD</title>\n<path fill=\"none\" stroke=\"#000000\" d=\"M254.5177,-563.4229C266.9552,-532.3479 286.6303,-483.1893 298.902,-452.5285\"/>\n<polygon fill=\"#000000\" stroke=\"#000000\" points=\"302.2922,-453.477 302.7587,-442.8925 295.7934,-450.8759 302.2922,-453.477\"/>\n</g>\n<!-- components -->\n<g id=\"node3\" class=\"node\">\n<title>components</title>\n<path fill=\"none\" stroke=\"#000000\" d=\"M435.6557,-615.6821C435.6557,-618.5614 416.985,-620.9004 394,-620.9004 371.015,-620.9004 352.3443,-618.5614 352.3443,-615.6821 352.3443,-615.6821 352.3443,-568.7179 352.3443,-568.7179 352.3443,-565.8386 371.015,-563.4996 394,-563.4996 416.985,-563.4996 435.6557,-565.8386 435.6557,-568.7179 435.6557,-568.7179 435.6557,-615.6821 435.6557,-615.6821\"/>\n<path fill=\"none\" stroke=\"#000000\" d=\"M435.6557,-615.6821C435.6557,-612.8028 416.985,-610.4639 394,-610.4639 371.015,-610.4639 352.3443,-612.8028 352.3443,-615.6821\"/>\n<text text-anchor=\"start\" x=\"360.1725\" y=\"-596.4\" font-family=\"Times,serif\" font-size=\"14.00\" fill=\"#000000\">components</text>\n<text text-anchor=\"middle\" x=\"394\" y=\"-579.6\" font-family=\"Times,serif\" font-size=\"14.00\" fill=\"#000000\"> (redux)</text>\n</g>\n<!-- components&#45;&gt;findIdsWithoutDD -->\n<g id=\"edge10\" class=\"edge\">\n<title>components&#45;&gt;findIdsWithoutDD</title>\n<path fill=\"none\" stroke=\"#000000\" d=\"M379.5599,-563.4229C363.8989,-532.2128 339.0846,-482.7615 323.7138,-452.1296\"/>\n<polygon fill=\"#000000\" stroke=\"#000000\" points=\"326.6919,-450.2606 319.0787,-442.8925 320.4354,-453.4001 326.6919,-450.2606\"/>\n</g>\n<!-- createNode -->\n<g id=\"node4\" class=\"node\">\n<title>createNode</title>\n<polygon fill=\"none\" stroke=\"#000000\" points=\"608.0204,-610.2 453.9796,-610.2 453.9796,-574.2 608.0204,-574.2 608.0204,-610.2\"/>\n<text text-anchor=\"middle\" x=\"531\" y=\"-588\" font-family=\"Times,serif\" font-size=\"14.00\" fill=\"#000000\">CREATE_NODE action</text>\n</g>\n<!-- dirtyActions -->\n<g id=\"node5\" class=\"node\">\n<title>dirtyActions</title>\n<path fill=\"none\" stroke=\"#000000\" d=\"M538.9888,-511.5273C538.9888,-513.3331 519.7205,-514.8 496,-514.8 472.2795,-514.8 453.0112,-513.3331 453.0112,-511.5273 453.0112,-511.5273 453.0112,-482.0727 453.0112,-482.0727 453.0112,-480.2669 472.2795,-478.8 496,-478.8 519.7205,-478.8 538.9888,-480.2669 538.9888,-482.0727 538.9888,-482.0727 538.9888,-511.5273 538.9888,-511.5273\"/>\n<path fill=\"none\" stroke=\"#000000\" d=\"M538.9888,-511.5273C538.9888,-509.7214 519.7205,-508.2545 496,-508.2545 472.2795,-508.2545 453.0112,-509.7214 453.0112,-511.5273\"/>\n<text text-anchor=\"middle\" x=\"496\" y=\"-492.6\" font-family=\"Times,serif\" font-size=\"14.00\" fill=\"#000000\">dirtyActions</text>\n</g>\n<!-- createNode&#45;&gt;dirtyActions -->\n<g id=\"edge11\" class=\"edge\">\n<title>createNode&#45;&gt;dirtyActions</title>\n<path fill=\"none\" stroke=\"#000000\" d=\"M524.2516,-573.8059C519.135,-559.8594 512.0163,-540.4558 506.2049,-524.6156\"/>\n<polygon fill=\"#000000\" stroke=\"#000000\" points=\"509.3391,-522.9967 502.6089,-514.8141 502.7674,-525.4077 509.3391,-522.9967\"/>\n</g>\n<!-- findDirtyActions -->\n<g id=\"node8\" class=\"node\">\n<title>findDirtyActions</title>\n<polygon fill=\"none\" stroke=\"#000000\" points=\"556.4678,-442.8 435.5322,-442.8 435.5322,-406.8 556.4678,-406.8 556.4678,-442.8\"/>\n<text text-anchor=\"middle\" x=\"496\" y=\"-420.6\" font-family=\"Times,serif\" font-size=\"14.00\" fill=\"#000000\">findDirtyActions()</text>\n</g>\n<!-- dirtyActions&#45;&gt;findDirtyActions -->\n<g id=\"edge3\" class=\"edge\">\n<title>dirtyActions&#45;&gt;findDirtyActions</title>\n<path fill=\"none\" stroke=\"#000000\" d=\"M496,-478.6314C496,-470.931 496,-461.7743 496,-453.2166\"/>\n<polygon fill=\"#000000\" stroke=\"#000000\" points=\"499.5001,-453.2132 496,-443.2133 492.5001,-453.2133 499.5001,-453.2132\"/>\n</g>\n<!-- queryJobs -->\n<g id=\"node9\" class=\"node\">\n<title>queryJobs</title>\n<polygon fill=\"none\" stroke=\"#000000\" points=\"393.6093,-370.8 226.3907,-370.8 226.3907,-334.8 393.6093,-334.8 393.6093,-370.8\"/>\n<text text-anchor=\"middle\" x=\"310\" y=\"-348.6\" font-family=\"Times,serif\" font-size=\"14.00\" fill=\"#000000\">runQueriesForPathnames()</text>\n</g>\n<!-- extractedQueryQ&#45;&gt;queryJobs -->\n<g id=\"edge1\" class=\"edge\">\n<title>extractedQueryQ&#45;&gt;queryJobs</title>\n<path fill=\"none\" stroke=\"#000000\" d=\"M152.7208,-406.7243C181.5538,-396.8387 217.4481,-384.5321 247.6631,-374.1726\"/>\n<polygon fill=\"#000000\" stroke=\"#000000\" points=\"248.9332,-377.4373 257.2575,-370.8831 246.6629,-370.8156 248.9332,-377.4373\"/>\n</g>\n<!-- findIdsWithoutDD&#45;&gt;queryJobs -->\n<g id=\"edge2\" class=\"edge\">\n<title>findIdsWithoutDD&#45;&gt;queryJobs</title>\n<path fill=\"none\" stroke=\"#000000\" d=\"M310,-406.6314C310,-398.931 310,-389.7743 310,-381.2166\"/>\n<polygon fill=\"#000000\" stroke=\"#000000\" points=\"313.5001,-381.2132 310,-371.2133 306.5001,-381.2133 313.5001,-381.2132\"/>\n</g>\n<!-- findDirtyActions&#45;&gt;queryJobs -->\n<g id=\"edge4\" class=\"edge\">\n<title>findDirtyActions&#45;&gt;queryJobs</title>\n<path fill=\"none\" stroke=\"#000000\" d=\"M449.0643,-406.6314C423.8563,-396.8734 392.6074,-384.777 366.1209,-374.5242\"/>\n<polygon fill=\"#000000\" stroke=\"#000000\" points=\"367.1873,-371.184 356.5981,-370.838 364.6603,-377.712 367.1873,-371.184\"/>\n</g>\n<!-- queryQ -->\n<g id=\"node10\" class=\"node\">\n<title>queryQ</title>\n<polygon fill=\"none\" stroke=\"#000000\" points=\"352.9608,-286 267.0392,-286 267.0392,-250 352.9608,-250 352.9608,-286\"/>\n<text text-anchor=\"middle\" x=\"310\" y=\"-263.8\" font-family=\"Times,serif\" font-size=\"14.00\" fill=\"#000000\">better&#45;queue</text>\n</g>\n<!-- queryJobs&#45;&gt;queryQ -->\n<g id=\"edge12\" class=\"edge\">\n<title>queryJobs&#45;&gt;queryQ</title>\n<path fill=\"none\" stroke=\"#000000\" d=\"M310,-334.3997C310,-332.6235 310,-330.7635 310,-328.8407\"/>\n<polygon fill=\"#000000\" stroke=\"#000000\" points=\"313.5001,-328.7998 310,-318.7999 306.5001,-328.7999 313.5001,-328.7998\"/>\n</g>\n<!-- graphqlJs -->\n<g id=\"node11\" class=\"node\">\n<title>graphqlJs</title>\n<ellipse fill=\"none\" stroke=\"#000000\" cx=\"310\" cy=\"-183.2\" rx=\"155.6479\" ry=\"18\"/>\n<text text-anchor=\"middle\" x=\"310\" y=\"-179\" font-family=\"Times,serif\" font-size=\"14.00\" fill=\"#000000\">graphqlJs(schema, query, context, ...)</text>\n</g>\n<!-- queryQ&#45;&gt;graphqlJs -->\n<g id=\"edge13\" class=\"edge\">\n<title>queryQ&#45;&gt;graphqlJs</title>\n<path fill=\"none\" stroke=\"#000000\" d=\"M310,-249.5997C310,-247.8235 310,-245.9635 310,-244.0407\"/>\n<polygon fill=\"#000000\" stroke=\"#000000\" points=\"313.5001,-243.9998 310,-233.9999 306.5001,-243.9999 313.5001,-243.9998\"/>\n</g>\n<!-- result -->\n<g id=\"node12\" class=\"node\">\n<title>result</title>\n<ellipse fill=\"none\" stroke=\"#000000\" cx=\"310\" cy=\"-111.2\" rx=\"62.0187\" ry=\"18\"/>\n<text text-anchor=\"middle\" x=\"310\" y=\"-107\" font-family=\"Times,serif\" font-size=\"14.00\" fill=\"#000000\">Query Result</text>\n</g>\n<!-- graphqlJs&#45;&gt;result -->\n<g id=\"edge5\" class=\"edge\">\n<title>graphqlJs&#45;&gt;result</title>\n<path fill=\"none\" stroke=\"#000000\" d=\"M310,-165.0314C310,-157.331 310,-148.1743 310,-139.6166\"/>\n<polygon fill=\"#000000\" stroke=\"#000000\" points=\"313.5001,-139.6132 310,-129.6133 306.5001,-139.6133 313.5001,-139.6132\"/>\n</g>\n<!-- diskResult -->\n<g id=\"node13\" class=\"node\">\n<title>diskResult</title>\n<path fill=\"none\" stroke=\"#000000\" d=\"M319.7488,-43.3273C319.7488,-45.1331 281.3148,-46.6 234,-46.6 186.6852,-46.6 148.2512,-45.1331 148.2512,-43.3273 148.2512,-43.3273 148.2512,-13.8727 148.2512,-13.8727 148.2512,-12.0669 186.6852,-10.6 234,-10.6 281.3148,-10.6 319.7488,-12.0669 319.7488,-13.8727 319.7488,-13.8727 319.7488,-43.3273 319.7488,-43.3273\"/>\n<path fill=\"none\" stroke=\"#000000\" d=\"M319.7488,-43.3273C319.7488,-41.5214 281.3148,-40.0545 234,-40.0545 186.6852,-40.0545 148.2512,-41.5214 148.2512,-43.3273\"/>\n<text text-anchor=\"middle\" x=\"234\" y=\"-24.4\" font-family=\"Times,serif\" font-size=\"14.00\" fill=\"#000000\">/public/static/d/${dataPath}</text>\n</g>\n<!-- result&#45;&gt;diskResult -->\n<g id=\"edge6\" class=\"edge\">\n<title>result&#45;&gt;diskResult</title>\n<path fill=\"none\" stroke=\"#000000\" d=\"M293.8824,-93.6827C283.346,-82.2313 269.4048,-67.0795 257.6252,-54.2769\"/>\n<polygon fill=\"#000000\" stroke=\"#000000\" points=\"259.9664,-51.6522 250.6198,-46.6631 254.8151,-56.3919 259.9664,-51.6522\"/>\n</g>\n<!-- jsonDataPaths -->\n<g id=\"node14\" class=\"node\">\n<title>jsonDataPaths</title>\n<path fill=\"none\" stroke=\"#000000\" d=\"M434.094,-52.0821C434.094,-54.9614 412.5375,-57.3004 386,-57.3004 359.4625,-57.3004 337.906,-54.9614 337.906,-52.0821 337.906,-52.0821 337.906,-5.1179 337.906,-5.1179 337.906,-2.2386 359.4625,.1004 386,.1004 412.5375,.1004 434.094,-2.2386 434.094,-5.1179 434.094,-5.1179 434.094,-52.0821 434.094,-52.0821\"/>\n<path fill=\"none\" stroke=\"#000000\" d=\"M434.094,-52.0821C434.094,-49.2028 412.5375,-46.8639 386,-46.8639 359.4625,-46.8639 337.906,-49.2028 337.906,-52.0821\"/>\n<text text-anchor=\"start\" x=\"345.953\" y=\"-32.8\" font-family=\"Times,serif\" font-size=\"14.00\" fill=\"#000000\">jsonDataPaths</text>\n<text text-anchor=\"middle\" x=\"386\" y=\"-16\" font-family=\"Times,serif\" font-size=\"14.00\" fill=\"#000000\">(redux)</text>\n</g>\n<!-- result&#45;&gt;jsonDataPaths -->\n<g id=\"edge7\" class=\"edge\">\n<title>result&#45;&gt;jsonDataPaths</title>\n<path fill=\"none\" stroke=\"#000000\" d=\"M326.1176,-93.6827C333.8259,-85.305 343.3564,-74.9468 352.5297,-64.9769\"/>\n<polygon fill=\"#000000\" stroke=\"#000000\" points=\"355.2436,-67.1965 359.4389,-57.4677 350.0923,-62.4569 355.2436,-67.1965\"/>\n</g>\n</g>\n</svg>\n\n<h4 id=\"figuring-out-which-queries-need-to-be-executed\"><a href=\"#figuring-out-which-queries-need-to-be-executed\" aria-label=\"figuring out which queries need to be executed permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Figuring out which queries need to be executed</h4>\n<p>The first thing this query does is figure out what queries even need to be run. You would think this would simply be a matter of running the Queries that were enqueued in <a href=\"/docs/query-extraction/\">Extract Queries</a>, but matters are complicated by support for <code class=\"language-text\">develop</code>. Below is the logic for figuring out which queries need to be executed (code is in <a href=\"https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby/src/internal-plugins/query-runner/page-query-runner.js#L36\">runQueries()</a>).</p>\n<h5 id=\"already-queued-queries\"><a href=\"#already-queued-queries\" aria-label=\"already queued queries permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Already queued queries</h5>\n<p>All queries queued after being extracted (from <code class=\"language-text\">query-watcher.js</code>).</p>\n<h5 id=\"queries-without-node-dependencies\"><a href=\"#queries-without-node-dependencies\" aria-label=\"queries without node dependencies permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Queries without node dependencies</h5>\n<p>All queries whose component path isnâ€™t listed in <code class=\"language-text\">componentDataDependencies</code>. As a recap, in <a href=\"/docs/schema-generation/\">Schema Generation</a>, we showed that all Type resolvers record a dependency between the page whose query weâ€™re running and any nodes that were successfully resolved. So, If a component is declared in the <code class=\"language-text\">components</code> redux namespace (occurs during <a href=\"/docs/page-creation/\">Page Creation</a>), but is <em>not</em> contained in <code class=\"language-text\">componentDataDependencies</code>, then by definition, the query has not been run. Therefore we need to run it. Checkout <a href=\"/docs/page-node-dependencies/\">Page -> Node Dependencies</a> for more info. The code for this step is in <a href=\"https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby/src/internal-plugins/query-runner/page-query-runner.js#L89\">findIdsWithoutDataDependencies</a>.</p>\n<h5 id=\"pages-that-depend-on-dirty-nodes\"><a href=\"#pages-that-depend-on-dirty-nodes\" aria-label=\"pages that depend on dirty nodes permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pages that depend on dirty nodes</h5>\n<p>In <code class=\"language-text\">develop</code> mode, every time a node is created, or is updated (e.g via editing a markdown file), we add that node to the <a href=\"https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby/src/internal-plugins/query-runner/page-query-runner.js#L61\">enqueuedDirtyActions</a> collection. When we execute our queries, we can lookup all nodes in this collection and map them to pages that depend on them (as described above). These pagesâ€™ queries must also be executed. In addition, this step also handles dirty <code class=\"language-text\">connections</code> (see <a href=\"/docs/schema-connections/\">Schema Connections</a>). Connections depend on a nodeâ€™s type. So if a node is dirty, we mark all connection nodes of that type dirty as well. The code for this step is in <a href=\"https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby/src/internal-plugins/query-runner/page-query-runner.js#L171\">findDirtyIds</a>. <em>Note: dirty ids is really talking about dirty paths</em>.</p>\n<h4 id=\"queue-queries-for-execution\"><a href=\"#queue-queries-for-execution\" aria-label=\"queue queries for execution permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Queue Queries for Execution</h4>\n<p>We now have the list of all pages that need to be executed (linked to their Query information). Letâ€™s queue them for execution (for realz this time). A call to <a href=\"https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby/src/internal-plugins/query-runner/page-query-runner.js#L21\">runQueriesForPathnames</a> kicks off this step. For each page or static query, we create a Query Job that looks something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">{</span>\n  id<span class=\"token punctuation\">:</span> <span class=\"token comment\">// page path, or static query hash</span>\n  hash<span class=\"token punctuation\">:</span> <span class=\"token comment\">// only for static queries</span>\n  jsonName<span class=\"token punctuation\">:</span> <span class=\"token comment\">// jsonName of static query or page</span>\n  query<span class=\"token punctuation\">:</span> <span class=\"token comment\">// raw query text</span>\n  componentPath<span class=\"token punctuation\">:</span> <span class=\"token comment\">// path to file where query is declared</span>\n  isPage<span class=\"token punctuation\">:</span> <span class=\"token comment\">// true if not static query</span>\n  context<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    path<span class=\"token punctuation\">:</span> <span class=\"token comment\">// if staticQuery, is jsonName of component</span>\n    <span class=\"token operator\">...</span>page <span class=\"token comment\">// page object. Not for static queries</span>\n    <span class=\"token operator\">...</span>page<span class=\"token punctuation\">.</span>context <span class=\"token comment\">// not for static queries</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This Query Job contains everything we need to execute the query (and do things like recording dependencies between pages and nodes). So, we push it onto the queue in <a href=\"https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby/src/internal-plugins/query-runner/query-queue.js\">query-queue.js</a> and then wait for the queue to empty. Letâ€™s see how <code class=\"language-text\">query-queue</code> works.</p>\n<h4 id=\"query-queue-execution\"><a href=\"#query-queue-execution\" aria-label=\"query queue execution permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Query Queue Execution</h4>\n<p><a href=\"https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby/src/internal-plugins/query-runner/query-queue.js\">query-queue.js</a> creates a <a href=\"https://www.npmjs.com/package/better-queue\">better-queue</a> queue that offers advanced features like parallel execution, which is handy since queries do not depend on each other so we can take advantage of this. Every time an item is consumed from the queue, we call <a href=\"https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby/src/internal-plugins/query-runner/query-runner.js\">query-runner.js</a> where we finally actually execute the query!</p>\n<p>Query execution involves calling the <a href=\"https://graphql.org/graphql-js/\">graphql-js</a> library with 3 pieces of information:</p>\n<ol>\n<li>The Gatsby schema that was inferred during <a href=\"/docs/schema-generation/\">Schema Generation</a>.</li>\n<li>The raw query text. Obtained from the Query Job.</li>\n<li>The Context, also from the Query Job. Has the pageâ€™s <code class=\"language-text\">path</code> amongst other things so that we can record <a href=\"/docs/page-node-dependencies/\">Page -> Node Dependencies</a>.</li>\n</ol>\n<p>Graphql-js will parse the query, and executes the top level query. E.g <code class=\"language-text\">allMarkdownRemark( limit: 10 )</code> or <code class=\"language-text\">file( relativePath: { eq: &quot;blog/my-blog.md&quot; } )</code>. These will invoke the resolvers defined in <a href=\"/docs/schema-connections/\">Schema Connections</a> or <a href=\"/docs/schema-gql-type/\">GQL Type</a>, which both use sift to query over all nodes of the type in redux. The result will be passed through the inner part of the graphql query where each typeâ€™s resolver will be invoked. The vast majority of these will be <code class=\"language-text\">identity</code> functions that just return the field value. Some however could call a <a href=\"/docs/schema-gql-type/#plugin-fields\">custom plugin field</a> resolver. These in turn might perform side effects such as generating images. This is why the query execution phase of bootstrap often takes the longest.</p>\n<p>Finally, a result is returned.</p>\n<h4 id=\"save-query-results-to-redux-and-disk\"><a href=\"#save-query-results-to-redux-and-disk\" aria-label=\"save query results to redux and disk permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Save Query results to redux and disk</h4>\n<p>As queries are consumed from the queue and executed, their results are saved to redux and disk for consumption later on. This involves converting the result to pure JSON, and then saving it to its <a href=\"/docs/behind-the-scenes-terminology/#datapath\">dataPath</a>. Which is relative to <code class=\"language-text\">public/static/d</code>. The data path includes the jsonName and hash. E.g: for the page <code class=\"language-text\">/blog/2018-07-17-announcing-gatsby-preview/</code>, the queries results would be saved to disk as something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">/public/static/d/621/path---blog-2018-07-17-announcing-gatsby-preview-995-a74-dwfQIanOJGe2gi27a9CLKHjamc.json</code></pre></div>\n<p>For static queries, instead of using the pageâ€™s jsonName, we just use a hash of the query.</p>\n<p>Now we need to store the association of the page -> the query result in redux so we can recall it later. This is accomplished via the <a href=\"https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby/src/redux/reducers/json-data-paths.js\">json-data-paths</a> reducer which we invoke by creating a <code class=\"language-text\">SET_JSON_DATA_PATH</code> action with the pageâ€™s jsonName and the saved dataPath.</p>"}