{"expireTime":9007200804686328000,"key":"transformer-remark-markdown-html-d449e1febfc0f9dd31595941ac47e986-gatsby-remark-graphvizgatsby-remark-code-titlesgatsby-remark-imagesgatsby-remark-responsive-iframegatsby-remark-autolink-headersgatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypants-","val":"<p><em>Before creating custom webpack configuration, check to see if there‚Äôs a Gatsby\nplugin already built that handles your use case in the\n<a href=\"/docs/plugins/\">plugins section</a>. If there‚Äôs not yet one and your use case is a\ngeneral one, we highly encourage you to contribute back your plugin to the\nGatsby Plugin Library so it‚Äôs available to others (including your future self üòÄ).</em></p>\n<p>To add custom webpack configurations, create (if there‚Äôs not one already) a\n<code class=\"language-text\">gatsby-node.js</code> file in your root directory. Inside this file, export a\nfunction called <code class=\"language-text\">onCreateWebpackConfig</code>.</p>\n<p>When Gatsby creates its webpack config, this function will be called allowing\nyou to modify the default webpack config using\n<a href=\"https://github.com/survivejs/webpack-merge\">webpack-merge</a>.</p>\n<p>Gatsby does multiple webpack builds with somewhat different configuration. We\ncall each build type a ‚Äústage‚Äù. The following stages exist:</p>\n<ol>\n<li>develop: when running the <code class=\"language-text\">gatsby develop</code> command. Has configuration for hot\nreloading and CSS injection into page</li>\n<li>develop-html: same as develop but without react-hmre in the babel config for\nrendering the HTML component.</li>\n<li>build-javascript: production JavaScript and CSS build. Creates route JS bundles as well\nas commons chunks for JS and CSS.</li>\n<li>build-html: production build static HTML pages</li>\n</ol>\n<p>Check\n<a href=\"https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby/src/utils/webpack.config.js\">webpack.config.js</a>\nfor the source.</p>\n<p>There are many plugins in the Gatsby repo using this API to look to for examples\ne.g. <a href=\"/packages/gatsby-plugin-sass/\">Sass</a>,\n<a href=\"/packages/gatsby-plugin-typescript/\">TypeScript</a>,\n<a href=\"/packages/gatsby-plugin-glamor/\">Glamor</a>, and many more!</p>\n<h2 id=\"examples\"><a href=\"#examples\" aria-label=\"examples permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Examples</h2>\n<p>Here is an example adding an additional global variable via the <code class=\"language-text\">DefinePlugin</code> and the <code class=\"language-text\">less-loader</code>:</p>\n<div class=\"gatsby-code-title\">gatsby-node.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">exports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onCreateWebpackConfig</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  stage<span class=\"token punctuation\">,</span>\n  rules<span class=\"token punctuation\">,</span>\n  loaders<span class=\"token punctuation\">,</span>\n  plugins<span class=\"token punctuation\">,</span>\n  actions<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  actions<span class=\"token punctuation\">.</span><span class=\"token function\">setWebpackConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    module<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      rules<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n          test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.less$/</span><span class=\"token punctuation\">,</span>\n          use<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token comment\">// We don't need to add the matching ExtractText plugin</span>\n            <span class=\"token comment\">// because gatsby already includes it and makes sure its only</span>\n            <span class=\"token comment\">// run at the appropriate stages, e.g. not in development</span>\n            loaders<span class=\"token punctuation\">.</span><span class=\"token function\">miniCssExtract</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            loaders<span class=\"token punctuation\">.</span><span class=\"token function\">css</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> importLoaders<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token comment\">// the postcss loader comes with some nice defaults</span>\n            <span class=\"token comment\">// including autoprefixer for our configured browsers</span>\n            loaders<span class=\"token punctuation\">.</span><span class=\"token function\">postcss</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token template-string\"><span class=\"token string\">`less-loader`</span></span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n      plugins<span class=\"token punctuation\">.</span><span class=\"token function\">define</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        __DEVELOPMENT__<span class=\"token punctuation\">:</span> stage <span class=\"token operator\">===</span> <span class=\"token template-string\"><span class=\"token string\">`develop`</span></span> <span class=\"token operator\">||</span> stage <span class=\"token operator\">===</span> <span class=\"token template-string\"><span class=\"token string\">`develop-html`</span></span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"absolute-imports\"><a href=\"#absolute-imports\" aria-label=\"absolute imports permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Absolute imports</h3>\n<p>Instead of writing <code class=\"language-text\">import Header from &#39;../../components/header&#39;</code> over and over again you can just write <code class=\"language-text\">import Header from &#39;components/header&#39;</code> with absolute imports:</p>\n<div class=\"gatsby-code-title\">gatsby-node.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">exports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onCreateWebpackConfig</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> stage<span class=\"token punctuation\">,</span> actions <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  actions<span class=\"token punctuation\">.</span><span class=\"token function\">setWebpackConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    resolve<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      modules<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">\"src\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"node_modules\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>You can always find more information on <em>resolve</em> and other options in the official <a href=\"https://webpack.js.org/concepts/\">Webpack docs</a>.</p>\n<h3 id=\"modifying-the-babel-loader\"><a href=\"#modifying-the-babel-loader\" aria-label=\"modifying the babel loader permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Modifying the babel loader</h3>\n<p>You need this if you want to do things like transpile parts of <code class=\"language-text\">node_modules</code>.</p>\n<div class=\"gatsby-code-title\">gatsby-node.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">exports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onCreateWebpackConfig</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> actions<span class=\"token punctuation\">,</span> loaders<span class=\"token punctuation\">,</span> getConfig <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> config <span class=\"token operator\">=</span> <span class=\"token function\">getConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  config<span class=\"token punctuation\">.</span>module<span class=\"token punctuation\">.</span>rules <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token comment\">// Omit the default rule where test === '\\.jsx?$'</span>\n    <span class=\"token operator\">...</span>config<span class=\"token punctuation\">.</span>module<span class=\"token punctuation\">.</span>rules<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>\n      rule <span class=\"token operator\">=></span> <span class=\"token function\">String</span><span class=\"token punctuation\">(</span>rule<span class=\"token punctuation\">.</span>test<span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token function\">String</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/\\.jsx?$/</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// Recreate it with custom exclude filter</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Called without any arguments, `loaders.js` will return an</span>\n      <span class=\"token comment\">// object like:</span>\n      <span class=\"token comment\">// {</span>\n      <span class=\"token comment\">//   options: undefined,</span>\n      <span class=\"token comment\">//   loader: '/path/to/node_modules/gatsby/dist/utils/babel-loader.js',</span>\n      <span class=\"token comment\">// }</span>\n      <span class=\"token comment\">// Unless you're replacing Babel with a different transpiler, you probably</span>\n      <span class=\"token comment\">// want this so that Gatsby will apply its required Babel</span>\n      <span class=\"token comment\">// presets/plugins.  This will also merge in your configuration from</span>\n      <span class=\"token comment\">// `babel.config.js`.</span>\n      <span class=\"token operator\">...</span>loaders<span class=\"token punctuation\">.</span><span class=\"token function\">js</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n      test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.jsx?$/</span><span class=\"token punctuation\">,</span>\n\n      <span class=\"token comment\">// Exclude all node_modules from transpilation, except for 'swiper' and 'dom7'</span>\n      exclude<span class=\"token punctuation\">:</span> modulePath <span class=\"token operator\">=></span>\n        <span class=\"token regex\">/node_modules/</span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>modulePath<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span>\n        <span class=\"token operator\">!</span><span class=\"token regex\">/node_modules\\/(swiper|dom7)/</span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>modulePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span>\n\n  <span class=\"token comment\">// This will completely replace the webpack config with the modified object.</span>\n  actions<span class=\"token punctuation\">.</span><span class=\"token function\">replaceWebpackConfig</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>"}