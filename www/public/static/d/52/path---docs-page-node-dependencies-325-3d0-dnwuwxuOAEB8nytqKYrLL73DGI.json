{"data":{"markdownRemark":{"html":"<p>In almost every GraphQL Resolver, you’ll see the <a href=\"https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby/src/redux/actions.js#L788\">createPageDependency</a>, or <a href=\"https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby/src/redux/index.js#L198\">getNodeAndSavePathDependency</a> functions. These are responsible for recording which nodes are depended on by which pages. In <code class=\"language-text\">develop</code> mode, if a node’s content changes, we re-run pages whose queries depend on that node. This is one of the things that makes <code class=\"language-text\">develop</code> so awesome.</p>\n<h2 id=\"how-dependencies-are-recorded\"><a href=\"#how-dependencies-are-recorded\" aria-label=\"how dependencies are recorded permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How dependencies are recorded</h2>\n<p>Recording of Page -> Node dependencies are handled by the <a href=\"https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby/src/redux/actions.js#L788\">createPageDependency</a> action. It takes the page (in the form of its <code class=\"language-text\">path</code>), and either a <code class=\"language-text\">nodeId</code>, or <code class=\"language-text\">connection</code>.</p>\n<p>If a <code class=\"language-text\">nodeId</code> is passed, we’re telling Gatsby that the page depends specifically on this node. So, if the node is changed, then the page’s query needs to be re-executed.</p>\n<p><code class=\"language-text\">connection</code> is a Type string. E.g <code class=\"language-text\">MarkdownRemark</code>, or <code class=\"language-text\">File</code>. If <code class=\"language-text\">createPageDependency</code> is called with a page path and a <code class=\"language-text\">connection</code>, we are telling Gatsby that this page depends on all nodes of this type. Therefore if any node of this type changes (e.g a change to a markdown node), then this page must be rebuilt. This variant is only called from <a href=\"https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby/src/schema/run-sift.js#L264\">run-sift.js</a> when we’re running a query such as <code class=\"language-text\">allFile</code>, or <code class=\"language-text\">allMarkdownRemark</code>. See <a href=\"/docs/schema-connections/\">Schema Connections</a> for more info.</p>\n<h2 id=\"how-dependencies-are-stored\"><a href=\"#how-dependencies-are-stored\" aria-label=\"how dependencies are stored permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How dependencies are stored</h2>\n<p>Page -> Node dependencies are tracked via the <code class=\"language-text\">componentDataDependencies</code> redux namespace. <code class=\"language-text\">createPageDependency</code> is the only way to mutate it. The namespace is comprised of two sub structures:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">{</span>\n  nodes<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// mapping nodeId -> pages</span>\n  connections<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">}</span> <span class=\"token comment\">// mapping of type names -> pages</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Nodes</strong> is a map of nodeID to the set of pages that depend on that node. E.g</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// state.componentDataDependencies.nodes</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token template-string\"><span class=\"token string\">`ID of Some MarkdownRemark node`</span></span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token template-string\"><span class=\"token string\">`blogs/my-blog1`</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token template-string\"><span class=\"token string\">`blogs/my-blog2`</span></span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token template-string\"><span class=\"token string\">`otherId`</span></span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token template-string\"><span class=\"token string\">`more pages`</span></span><span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Connections</strong> is a map of type name to the set of pages that depend on that type. e.g</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// state.componentDataDependencies.connections</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token template-string\"><span class=\"token string\">`MarkdownRemark`</span></span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token template-string\"><span class=\"token string\">`blogs/my-blog1`</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token template-string\"><span class=\"token string\">`blogs/my-blog2`</span></span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token template-string\"><span class=\"token string\">`File`</span></span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token template-string\"><span class=\"token string\">`more pages`</span></span><span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"how-dependency-information-is-used\"><a href=\"#how-dependency-information-is-used\" aria-label=\"how dependency information is used permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How dependency information is used</h2>\n<p>Page -> Node dependencies are used entirely during query execution to figure out which nodes are “dirty”, and therefore which page’s queries need to be re-executed. This occurs in <code class=\"language-text\">page-query-runner.js</code> in the <a href=\"https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby/src/internal-plugins/query-runner/page-query-runner.js#L89\">findIdsWithoutDataDependencies</a> and <a href=\"https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby/src/internal-plugins/query-runner/page-query-runner.js#L171\">findDirtyIds</a> functions. This is described in greater detail in the <a href=\"/docs/query-execution/\">Query Execution</a> docs.</p>\n<h2 id=\"other-forms\"><a href=\"#other-forms\" aria-label=\"other forms permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Other forms</h2>\n<h3 id=\"add-page-dependencyjs\"><a href=\"#add-page-dependencyjs\" aria-label=\"add page dependencyjs permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>add-page-dependency.js</h3>\n<p><a href=\"https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby/src/redux/actions/add-page-dependency.js\">redux/actions/add-page-dependency.js</a> is a wrapper around the <code class=\"language-text\">createPageDependency</code> action that performs some additional performance optimizations. It should be used instead of the raw action.</p>\n<h3 id=\"getnodeandsavepathdependency-action\"><a href=\"#getnodeandsavepathdependency-action\" aria-label=\"getnodeandsavepathdependency action permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>getNodeAndSavePathDependency action</h3>\n<p>The <a href=\"https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby/src/redux/index.js#L198\">getNodeAndSavePathDependency</a> action simply calls <code class=\"language-text\">getNode</code>, and then calls <code class=\"language-text\">createPageDependency</code> using that result. It is a programmer convenience.</p>","excerpt":"In almost every GraphQL Resolver, you’ll see the  createPageDependency , or  getNodeAndSavePathDependency  functions. These are responsible…","timeToRead":3,"fields":{"slug":"/docs/page-node-dependencies/","anchor":"page-node-dependencies"},"frontmatter":{"title":"Page -> Node Dependency Tracking","overview":null,"issue":null},"parent":{"__typename":"File","relativePath":"docs/page-node-dependencies.md"}}},"pageContext":{"slug":"/docs/page-node-dependencies/"}}