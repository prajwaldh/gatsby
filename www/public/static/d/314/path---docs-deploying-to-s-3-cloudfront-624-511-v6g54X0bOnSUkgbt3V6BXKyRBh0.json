{"data":{"markdownRemark":{"html":"<p>In this guide, we’ll walk through how to host &#x26; publish your next Gatsby site to AWS using <a href=\"https://aws.amazon.com/s3/\">S3</a>.\nAdditionally - but very recommended - you can add CloudFront, a global CDN to make your site <em>even faster</em>.</p>\n<h2 id=\"getting-started-gatsby\"><a href=\"#getting-started-gatsby\" aria-label=\"getting started gatsby permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Getting Started - Gatsby</h2>\n<p>First, we’ll want to create a new Gatsby project. If you don’t already have Gatsby installed, install it:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --global gatsby-cli</code></pre></div>\n<p>Next, we’ll create a new Gatsby site:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">npx gatsby new my-gatsby-site</code></pre></div>\n<p>Finally, change into the new site directory:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">cd</span> my-gatsby-site</code></pre></div>\n<h2 id=\"getting-started---aws-cli\"><a href=\"#getting-started---aws-cli\" aria-label=\"getting started   aws cli permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Getting Started - AWS CLI</h2>\n<p>Create a <a href=\"https://console.aws.amazon.com/iam/home?#\">IAM account</a> with administration permissions and create a access id and secret for it.\nYou’ll need these in the next step.</p>\n<p>Install the AWS CLI and configure it (ensure python is installed before running these commands)</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">pip <span class=\"token function\">install</span> aws\naws configure</code></pre></div>\n<p>The AWS CLI will now prompt you for the key &#x26; secret, add them.</p>\n<h2 id=\"setting-up-s3\"><a href=\"#setting-up-s3\" aria-label=\"setting up s3 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setting up: S3</h2>\n<p>Now that we have our Gatsby site up &#x26; running, and our AWS access sorted out: let’s add hosting &#x26; make the site live on AWS.</p>\n<p>First, we’ll install the Gatsby S3 plugin:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">npm</span> i gatsby-plugin-s3</code></pre></div>\n<p>Add it to your <code class=\"language-text\">gatsby-config.js</code>: (don’t forget to change the bucket name)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">plugins: [\n {\n     resolve: `gatsby-plugin-s3`,\n     options: {\n         bucketName: &#39;my-website-bucket&#39;\n     },\n },\n]</code></pre></div>\n<p>And finally, add the deployment script to your <code class=\"language-text\">package.json</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token string\">\"scripts\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token operator\">...</span>\n   <span class=\"token string\">\"deploy\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"gatsby-plugin-s3 deploy\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>That’s it!\nRun <code class=\"language-text\">npm run build &amp;&amp; npm run deploy</code> to do a build and have it immediately deployed to S3!</p>\n<h2 id=\"setting-up-cloudfront\"><a href=\"#setting-up-cloudfront\" aria-label=\"setting up cloudfront permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setting up: CloudFront</h2>\n<p>CloudFront is a global CDN and can be used to make your blazing fast Gatsby site load <em>even faster</em>, particularly for first-time visitors. Additionally, CloudFront provides the easiest way to give your S3 bucket a custom domain name and HTTPS support.</p>\n<p>There are a couple of things that you need to consider when using gatsby-plugin-s3 to deploy a site which uses CloudFront.</p>\n<p>There are two ways that you can connect CloudFront to an S3 origin. The most obvious way, which the AWS Console will suggest, is to type the bucket name in the Origin Domain Name field. This sets up an S3 origin, and allows you to configure CloudFront to use IAM to access your bucket. Unfortunately, it also makes it impossible to perform serverside (301/302) redirects, and it also means that directory indexes (having index.html be served when someone tries to access a directory) will only work in the root directory. You might not initially notice these issues, because Gatsby’s clientside JavaScript compensates for the latter and plugins such as <code class=\"language-text\">gatsby-plugin-meta-redirect</code> can compensate for the former. But just because you can’t see these issues, doesn’t mean they won’t affect search engines.</p>\n<p>In order for all the features of your site to work correctly, you must instead use your S3 bucket’s Static Website Hosting Endpoint as the CloudFront origin. This does (sadly) mean that your bucket will have to be configured for public-read, because when CloudFront is using an S3 Static Website Hosting Endpoint address as the Origin, it’s incapable of authenticating via IAM.</p>\n<h3 id=\"gatsby-plugin-s3-configuration\"><a href=\"#gatsby-plugin-s3-configuration\" aria-label=\"gatsby plugin s3 configuration permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>gatsby-plugin-s3 configuration</h3>\n<p>In the gatsby-plugin-s3 configuration file, there are a couple of optional parameters that you can usually leave blank, <code class=\"language-text\">protocol</code> and <code class=\"language-text\">hostname</code>. But when you’re using CloudFront, these parameters are vital for ensuring redirects work correctly. If you omit these parameters, redirects will be performed relative to your S3 Static Website Hosting Endpoint. This means if a user visits your site via the CloudFront URL and hits a redirect, they will be redirected to your S3 Static Website Hosting Endpoint instead. This will disable HTTPS and (more importantly) will display an ugly and unprofessional URL in the user’s address bar.</p>\n<p>By specifying the <code class=\"language-text\">protocol</code> and <code class=\"language-text\">hostname</code> parameters, you can cause redirects to be applied relative to a domain of your choosing.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">{</span>\n    resolve<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`gatsby-plugin-s3`</span></span><span class=\"token punctuation\">,</span>\n    options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        bucketName<span class=\"token punctuation\">:</span> <span class=\"token string\">\"my-example-bucket\"</span><span class=\"token punctuation\">,</span>\n        protocol<span class=\"token punctuation\">:</span> <span class=\"token string\">\"https\"</span><span class=\"token punctuation\">,</span>\n        hostname<span class=\"token punctuation\">:</span> <span class=\"token string\">\"www.example.com\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>If you use your site’s URL elsewhere in gatsby-config.js, I have a tip for you. You can define the URL once at the top of the config:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> siteAddress <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://www.example.com\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>And then in the Gatsby config you can reference it like so:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">{</span>\n    resolve<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`gatsby-plugin-s3`</span></span><span class=\"token punctuation\">,</span>\n    options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        bucketName<span class=\"token punctuation\">:</span> <span class=\"token string\">\"my-example-bucket\"</span><span class=\"token punctuation\">,</span>\n        protocol<span class=\"token punctuation\">:</span> siteAddress<span class=\"token punctuation\">.</span>protocol<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        hostname<span class=\"token punctuation\">:</span> siteAddress<span class=\"token punctuation\">.</span>hostname<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>If you need the full address elsewhere in your config, you can access it via <code class=\"language-text\">siteAddress.href</code>.</p>\n<h2 id=\"references\"><a href=\"#references\" aria-label=\"references permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>References:</h2>\n<ul>\n<li><a href=\"https://blog.joshwalsh.me/aws-gatsby/\">Gatsby on AWS, the right way</a></li>\n<li><a href=\"https://github.com/jariz/gatsby-plugin-s3/blob/master/recipes/with-cloudfront.md\">Using CloudFront with gatsby-plugin-s3</a></li>\n<li><a href=\"https://www.gatsbyjs.org/blog/2018-08-24-gatsby-aws-hosting/\">Publishing Your Next Gatsby Site to AWS With AWS Amplify</a></li>\n<li><a href=\"https://www.gatsbyjs.org/blog/2018-06-14-escalade-sports-from-5000-to-5-in-hosting/\">Escalade Sports: From $5000 to $5/month in Hosting With Gatsby</a></li>\n<li><a href=\"https://benenewton.com/deploy-your-gatsby-js-site-to-aws-s-3\">Deploy your Gatsby.js Site to AWS S3</a></li>\n</ul>","excerpt":"In this guide, we’ll walk through how to host & publish your next Gatsby site to AWS using  S3 .\nAdditionally - but very recommended - you…","timeToRead":4,"fields":{"slug":"/docs/deploying-to-s3-cloudfront/","anchor":"deploying-to-s3-cloudfront"},"frontmatter":{"title":"Deploying to S3/Cloudfront","overview":null,"issue":null},"parent":{"__typename":"File","relativePath":"docs/deploying-to-s3-cloudfront.md"}}},"pageContext":{"slug":"/docs/deploying-to-s3-cloudfront/"}}