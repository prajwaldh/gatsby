{"data":{"markdownRemark":null,"npmPackage":{"name":"gatsby-source-pleroma","description":"gatsby-source plugin for Pleroma federated social network feed","keywords":["gatsby","gatsby-plugin","pleroma"],"lastPublisher":{"name":"foggy","avatar":"https://gravatar.com/avatar/2b64c1f0039ae8702cee222095d72347"},"repository":{"url":"git+https://gitlab.com/foggy1/gatsby-source-pleroma.git"},"readme":{"childMarkdownRemark":{"html":"<h1 id=\"gatsby-source-pleroma\"><a href=\"#gatsby-source-pleroma\" aria-label=\"gatsby source pleroma permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>gatsby-source-pleroma</h1>\n<p>Source plugin for pulling data into <a href=\"https://www.gatsbyjs.org/\">Gatsby</a> from a single user’s <a href=\"https://pleroma.social/\">Pleroma</a> feed.</p>\n<h2 id=\"installation-guide\"><a href=\"#installation-guide\" aria-label=\"installation guide permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installation guide</h2>\n<ul>\n<li>Install Gatsby</li>\n<li>\n<p>Install plugin with <code class=\"language-text\">npm</code> or <code class=\"language-text\">yarn</code></p>\n<ul>\n<li><code class=\"language-text\">npm install gatsby-source-pleroma --save</code></li>\n<li><code class=\"language-text\">yarn add gatsby-source-pleroma</code></li>\n</ul>\n</li>\n<li>Update your <code class=\"language-text\">gatsby-config.js</code> file with the following:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">module.exports = {\n siteMetadata: { ... },\n plugins: [\n   ...,\n   {\n     resolve: &#39;gatsby-source-pleroma&#39;,\n     options: {\n       instance: &#39;https://pleroma.example.site&#39;, // required\n       userId: 1, // required,\n       pages: 2 // optional\n     }\n   }\n ]\n}</code></pre></div>\n<h2 id=\"options\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p>When requiring the plugin, there are several options that must be passed down and a few that can be optionally passed down, in order to determine whose data you are including and exactly how much.</p>\n<ul>\n<li><code class=\"language-text\">instance</code> (required): The url (no trailing slash!) of the instance to which the user belongs. e.g. if you’re signed up for pleroma at the main <code class=\"language-text\">https://pleroma.site</code>, you would use that exact string.</li>\n<li><code class=\"language-text\">userId</code> (required): The integer id <strong>or</strong> username of the user for whom the feed is being fetched. When visiting a user profile on Pleroma, you can find this id in the url e.g. a userId of 1 is indicated by <code class=\"language-text\">https://pleroma.site/users/1</code>. This also goes for userId of ‘foggy’, which would be <code class=\"language-text\">https://pleroma.site/users/foggy</code>.</li>\n<li><code class=\"language-text\">pages</code> (optional | default: 1): If you would like to paginate from more than just the latest 20 posts in a pleroma feed, pass this option.</li>\n</ul>\n<h2 id=\"usage\"><a href=\"#usage\" aria-label=\"usage permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Usage</h2>\n<p>Pleroma data from the given user’s feed will be included as <code class=\"language-text\">allPleromaPost</code> in Gatsby’s graphQL infrastructure.</p>\n<p>As an example, a very large query that utilized a majority of the keys from a single post object from Pleroma’s twitter API would look like:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">query GetPleromaPosts {\n  allPleromaPost(sort: {fields: [statusnet_conversation_id], order:DESC}) {\n    edges {\n      node {\n        statusnet_conversation_id\n        activity_type\n        created_at\n        external_url\n        fave_num\n        id\n        in_reply_to_status_id\n        is_local\n        is_post_verb\n        repeat_num\n        repeated\n        statusnet_conversation_id\n        summary\n        uri\n        visibility\n        text\n        statusnet_html\n        user {\n          profile_image_url_https\n          screen_name\n          statusnet_profile_url\n        }\n        attachments {\n          url\n          empty\n        }\n      }\n    }\n  }\n}</code></pre></div>\n<p>This query would be sorted on the field <code class=\"language-text\">statusnet_conversation_id</code> in a descending fashion and would make all of the above key values available in the component which queried them in <code class=\"language-text\">this.props.data.edges.node</code>.</p>\n<h2 id=\"a-note-about-attachments\"><a href=\"#a-note-about-attachments\" aria-label=\"a note about attachments permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A Note About Attachments</h2>\n<p>Every time this plugin runs at build time, it is <em>dynamically</em> generating a graphql schema: what you are able to query is at the mercy of what the source plugin pulls in and builds the schema with. This is powerful because we do not have to explicitly define a schema ahead of time and only get what we want. But it is also a huge pain because if we are <em>expecting</em> something and we do <strong>not</strong> get it from any individual post, it won’t be in the schema, and declarations involving that item will crash our build.</p>\n<p>Attachments are a prime example of this.</p>\n<p>In order to thwart this, I’ve shimmed a placeholder attachment into the build process for any item which is fetched but lacks any attachments. The upside is, in just a line-and-a-half of code, I’ve undercut a nasty problem. Without this code, anytime you do the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">query somethingWithAttachmenets {\n  ...\n    ...\n      ...\n        attachments {\n          url\n        }\n}</code></pre></div>\n<p>If all you sourced were empty arrays, then your code is going to yell at you: it never built a node called “attachment” with knowledge of a “url” field.</p>\n<p>The downside of this is, we have to live with a slightly weird result: you will never get <em>no</em> attachments. You will always get at least one, and often, that one will be an empty attachment with a field <code class=\"language-text\">empty</code> set to <code class=\"language-text\">true</code>. </p>\n<p>At the moment, this is the best we can do. I’m unsatisfied with the complexity involved in other ways of dealing with this issue. Just keep in mind that if you want to check if you have no attachments, you need to check the truthiness of  <code class=\"language-text\">attachments[0].empty</code>.</p>","timeToRead":3}}}},"pageContext":{"slug":"/packages/gatsby-source-pleroma/","id":"8d62910f-bc02-580d-82a2-1f585f58cd58","layout":"plugins"}}